<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğ™¬ğ™¤ğ™¬,ğ“ğ¨ğğšğ² ğ’Šğ’” ğ“¶ğ”‚ ğš‹ğš’ğš›ğšğš‘ğšğšŠğš¢!!!</title>
  <script src="./av.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&family=Inter:wght@300;400;600&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --bg: #E6F0FF;
      /* æµ…è“èƒŒæ™¯ */
      --panel: #fff;
      /* é¢æ¿ä»ç„¶ç™½è‰² */
      --accent: #87CEFA;
      /* æµ…è“æ¸å˜ä¸»è‰² */
      --accent-2: #1E90FF;
      /* æ·±è“æ¸å˜æ¬¡è‰² */
      --muted: #5B6B8C;
      /* æ·±ç°è“æ–‡å­— */
      --shadow: 0 8px 30px rgba(70, 130, 180, 0.12);
      /* è“è‰²é˜´å½± */
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, 'Baloo 2', sans-serif;
      background: linear-gradient(180deg, var(--bg) 0%, #FFF 60%);
      color: #3b2b36
    }

    .frame {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 30px;
      box-sizing: border-box;
      position: relative;
      overflow: hidden;
    }

    /* cute border decorations */
    .frame::before,
    .frame::after {
      content: "";
      position: absolute;
      width: 46px;
      height: 46px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      box-shadow: var(--shadow);
      transform: rotate(12deg);
      opacity: 0.95;
    }

    .frame::before {
      left: 18px;
      top: 18px
    }

    .frame::after {
      right: 18px;
      bottom: 18px;
      transform: rotate(-10deg)
    }

    /* scattered small shapes */
    .spark {
      position: absolute;
      width: 12px;
      height: 12px;
      border-radius: 4px;
      background: var(--accent-2);
      box-shadow: 0 6px 14px rgba(255, 166, 121, 0.12);
      transform: rotate(18deg);
      opacity: 0.95;
    }

    .spark.s1 {
      left: 6%;
      top: 12%
    }

    .spark.s2 {
      right: 8%;
      top: 18%
    }

    .spark.s3 {
      left: 10%;
      bottom: 14%
    }

    .spark.s4 {
      right: 12%;
      bottom: 8%
    }

    /* main card */
    .card {
      width: 110%;
      max-width: 1100px;
      background: var(--panel);
      border-radius: 20px;
      padding: 28px;
      box-shadow: var(--shadow);
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 24px;
      align-items: center;
    }

    /* left: cake area */
    .cake-area {
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 16px;
    }

    /* big cake */
    .cake-wrap {
      width: min(78vw, 520px);
      max-width: 520px;
      aspect-ratio: 1/0.9;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    /* Add a soft spotlight */
    .spot {
      position: absolute;
      width: 86%;
      height: 56%;
      left: 7%;
      top: 18%;
      filter: blur(36px);
      background: radial-gradient(closest-side, rgba(150, 193, 215, 0.55), rgba(255, 255, 255, 0));
      z-index: 0;
    }

    /* right: controls */
    .side {
      padding: 22px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    h1 {
      font-family: 'Baloo 2', cursive;
      font-size: 28px;
      margin: 0;
      color: #1E90FF;
      letter-spacing: 0.6px;
    }

    p.lead {
      margin: 6px 0 18px;
      color: var(--muted);
      font-size: 14px
    }

    /* vertical playful texts */
    .vertical-texts {
      position: absolute;
      left: 30px;
      top: 40px;
      writing-mode: vertical-rl;
      transform: rotate(30deg);
      font-weight: 700;
      color: #87CEFA;
      font-family: 'Baloo 2';
      letter-spacing: 1px;
      text-shadow: 0 2px 6px rgba(0, 0, 0, 0.14);
      font-size: 18px;
    }

    .vertical-texts.two {
      right: 24px;
      left: auto;
      top: 80px;
      transform: rotate(-32deg);
      color: #87CEFA;
      font-size: 22px;
    }

    .vertical-texts.three {
      right: auto;
      left: 150px;
      top: 35px;
      transform: rotate(-250deg);
      color: #87CEFA;
      font-size: 28px;
    }

    /* input styles */
    .field {
      display: flex;
      flex-direction: column;
      gap: 6px
    }

    label {
      font-size: 12px;
      color: var(--muted)
    }

    input[type="text"],
    #text {
      border-radius: 12px;
      border: 1px solid rgba(100, 80, 100, 0.08);
      padding: 10px 12px;
      font-size: 14px;
      outline: none;
      box-shadow: inset 0 -2px 6px rgba(0, 0, 0, 0.03);
      resize: vertical;
    }

    #text {
      min-height: 80px;
      max-height: 180px
    }

    .btn {
      margin-top: 6px;
      background: linear-gradient(180deg, #87CEFA, #1E90FF);
      color: white;
      padding: 10px 14px;
      border-radius: 12px;
      border: none;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.18);
    }

    .btn:active {
      transform: translateY(1px)
    }

    /* cute list (recent messages preview) */
    .msgs {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 280px;
      overflow: auto;
      padding-right: 6px;
      word-wrap: break-word;
      white-space: normal;
    }

    .msg {
      background: linear-gradient(180deg, #d4f5ff, #fff);
      border-radius: 10px;
      padding: 10px;
      font-size: 13px;
      box-shadow: 0 4px 12px rgba(100, 141, 150, 0.06);
    }

    .msg small {
      color: var(--muted);
      display: block;
      font-size: 11px;
      margin-top: 6px
    }

    /* responsive */
    @media (max-width:900px) {
      .card {
        grid-template-columns: 1fr;
        padding: 18px
      }


      .cake-wrap {
        width: 86vw
      }
    }
  </style>
</head>

<body>
  <div class="frame" role="main" aria-label="ç”Ÿæ—¥é¡µé¢">
    <div class="spark s1"></div>
    <div class="spark s2"></div>
    <div class="spark s3"></div>
    <div class="spark s4"></div>

    <div class="card" id="card">
      <div class="cake-area">
        <div class="vertical-texts">ç¥æˆ‘è‡ªå·±ç”Ÿæ—¥å¿«ä¹</div>
        <div class="vertical-texts two">ç¥ä¸–ä¸Šç¨‹åºå°‘äº›bug</div>
        <div class="vertical-texts three">å˜»å˜»</div>

        <div class="cake-wrap" aria-hidden="false">
          <div class="spot"></div>

          <!-- SVG å¤§è›‹ç³•ï¼ˆå¯ç›´æ¥ç¼©æ”¾ï¼‰ -->
          <svg viewBox="0 0 800 720" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" role="img"
            aria-label="å¤§è›‹ç³•">
            <defs>
              <linearGradient id="icing" x1="0" x2="1">
                <stop offset="0" stop-color="#e6f0ff" />
                <stop offset="1" stop-color="#87cefa" />
              </linearGradient>
              <linearGradient id="cakegrad" x1="0" x2="1">
                <stop offset="0" stop-color="#87cefa" />
                <stop offset="1" stop-color="#1e90ff" />
              </linearGradient>
              <filter id="soft" x="-50%" y="-50%" width="200%" height="200%">
                <feDropShadow dx="0" dy="6" stdDeviation="12" flood-color="#4682b4" flood-opacity="0.12" />
              </filter>
            </defs>

            <ellipse cx="400" cy="620" rx="280" ry="42" fill="#d9e6ff" opacity="0.9" />

            <g filter="url(#soft)">
              <rect x="140" y="300" rx="48" ry="48" width="520" height="260" fill="url(#cakegrad)" />
            </g>

            <path
              d="M140 340 C170 300 220 360 270 345 C330 330 360 380 420 360 C480 340 520 390 590 360 C640 337 700 360 660 420 L140 420 Z"
              fill="url(#icing)" />

            <ellipse cx="400" cy="300" rx="240" ry="60" fill="#f0f8ff" />

            <g id="candles" transform="translate(0,0)">
              <g transform="translate(310,210)">
                <rect x="0" y="0" width="16" height="80" rx="6" fill="#87cefa" />
                <rect x="-8" y="-14" width="32" height="14" rx="8" fill="#e6f0ff" />
                <path d="M8 -22 C10 -28 6 -34 8 -40 C10 -34 14 -28 12 -22 Z" fill="#ffd66b" />
              </g>
              <g transform="translate(380,200)">
                <rect x="0" y="0" width="16" height="90" rx="6" fill="#1e90ff" />
                <rect x="-8" y="-14" width="32" height="14" rx="8" fill="#e6f0ff" />
                <path d="M8 -22 C10 -28 6 -34 8 -40 C10 -34 14 -28 12 -22 Z" fill="#ffd66b" />
              </g>
              <g transform="translate(450,210)">
                <rect x="0" y="0" width="16" height="80" rx="6" fill="#9be6ff" />
                <rect x="-8" y="-14" width="32" height="14" rx="8" fill="#e6f0ff" />
                <path d="M8 -22 C10 -28 6 -34 8 -40 C10 -34 14 -28 12 -22 Z" fill="#ffd66b" />
              </g>
            </g>

            <g>
              <rect x="260" y="360" width="6" height="14" rx="2" fill="#87cefa" transform="rotate(20 263 367)" />
              <rect x="320" y="380" width="6" height="14" rx="2" fill="#1e90ff" transform="rotate(-10 323 387)" />
              <rect x="420" y="360" width="6" height="14" rx="2" fill="#9be6ff" transform="rotate(30 423 367)" />
              <rect x="540" y="390" width="6" height="14" rx="2" fill="#d0ebff" transform="rotate(-20 543 397)" />
            </g>

            <g transform="translate(320,380)">
              <ellipse cx="80" cy="28" rx="12" ry="8" fill="#3b5b8c" opacity="0.9" />
              <ellipse cx="150" cy="28" rx="12" ry="8" fill="#3b5b8c" opacity="0.9" />
              <path d="M90 48 C110 62 130 62 150 48" stroke="#4682b4" stroke-width="6" stroke-linecap="round"
                fill="none" />
            </g>
          </svg>

        </div>
      </div>

      <div class="side" aria-live="polite">
        <h1>é€å‡ºä¸€ä»½ç¥ç¦ ğŸ‚</h1>
        <p class="lead">ç•™ä¸‹ä½ çš„nameå’Œä¸€å¥è¯ï¼Œå®ƒå°†å­˜è‡³äº‘ç«¯ï¼Œéšåä¸€ä¸ªå®‡å®™è¶…çº§æ— æ•Œå–„è‰¯zbyä¼šå·å·åœ°å»çœ‹<strong>o.O</strong></p>

        <div class="field">
          <label for="uid">ä½ çš„åå­—(è‹¥åŒ¿åç©ºç€å°±å¥½)</label>
          <input id="uid" type="text" placeholder="å“ˆåŸºç±³">
        </div>

        <div class="field">
          <label for="text">ç¥ç¦æˆ–ç•™è¨€</label>
          <textarea type="text" id="text" placeholder="ç”Ÿæ—¥å¿«ä¹ğŸ‚..."></textarea>
        </div>

        <label style="display:block; margin-bottom:10px; font-size:0.9em; color:#1E90FF;">
          <input type="checkbox" id="showOnBoard" checked>
          æ˜¯å¦åœ¨ä¸‹é¢å±•ç¤º(æ‰€æœ‰äººå¯è§) ğŸ’Œ
        </label>
        <button class="btn" id="sendBtn">é€å‡ºç¥ç¦</button>

        <div style="display:flex;gap:10px;align-items:center;margin-top:12px">
          <button id="refreshBtn"
            style="background:#fff;border:1px solid rgba(120,80,120,0.06);padding:8px 10px;border-radius:10px;cursor:pointer">åˆ·æ–°</button>
          <small style="color:var(--muted)">é€‰æ‹©æ˜¾ç¤ºç•™è¨€ä¼šæ˜¾ç¤ºåœ¨ä¸‹æ–¹ï¼ˆç•™è¨€æ€»æ•°å»ç é‡Œæ‰¾å§ï¼‰</small>
        </div>

        <div class="msgs" id="msgs" aria-atomic="true" style="margin-top:12px">
          <!-- messages loaded here -->
        </div>
      </div>
    </div>
  </div>

  <script>
    console.log("blqæ˜¯619ï¼Œæ²¡æœ‰åˆ«çš„æ„æ€ï¼Œæœ›è«æ··æ·†");
    const cakeText = `
                      ğŸŒŸğŸŒ™ğŸŒŸğŸŒ™ğŸŒŸğŸŒ™ğŸŒŸğŸŒ™ğŸŒŸğŸŒ™ğŸŒŸ
                    ğŸ€ğŸ’–ğŸ€ğŸ’–ğŸ€ğŸ’–ğŸ€ğŸ’–ğŸ€ğŸ’–ğŸ€ğŸ’–ğŸ€
               â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
               â•‘  ğŸŒ¸ğŸ’ğŸŒ¸  ğŸ“ğŸ’ğŸ“  ğŸ¥¨  ğŸ“ğŸ’ğŸ“  ğŸŒ¸ğŸ’ğŸŒ¸  â•‘
               â•‘    ğŸ’       ğ™ƒğ™–ğ™¥ğ™¥ğ™® ğ˜½ğ™ğ™§ğ™©ğ™ğ™™ğ™–ğ™®!!!       ğŸ’     â•‘
               â•‘  ğŸŒ¸ğŸ’ğŸŒ¸  ğŸ“ğŸ’ğŸ“  ğŸ¥¨  ğŸ“ğŸ’ğŸ“  ğŸŒ¸ğŸ’ğŸŒ¸  â•‘
               â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
               â•‘â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â–â•‘
               â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
               â•‘    âœ¨â˜ï¸âœ¨â˜ï¸âœ¨â˜ï¸âœ¨â˜ï¸âœ¨â˜ï¸âœ¨â˜ï¸âœ¨â˜ï¸âœ¨   â•‘
               â•‘    ğŸ¬ğŸ¬  ğŸ«ğŸ«ğŸ«  ğŸ¡ğŸ¡  ğŸ«ğŸ«ğŸ«  ğŸ¬ğŸ¬   â•‘
               â•‘   â˜ï¸âœ¨â˜ï¸âœ¨â˜ï¸âœ¨â˜ï¸âœ¨â˜ï¸âœ¨â˜ï¸âœ¨â˜ï¸âœ¨â˜ï¸   â•‘
               â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
               â•‘â–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ–ƒâ•‘
               â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
               â•‘  ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚  â•‘
               â•‘  ğŸ‚  ğŸ‰ğŸŠğŸ‰      ğŸ¯ğŸ¯      ğŸ‰ğŸŠğŸ‰  ğŸ‚  â•‘
               â•‘  ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚ğŸ‚  â•‘
               â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
               â•‘â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â–…â•‘
               â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
               â•‘  ğŸªğŸª ğŸ¥ğŸ¥ğŸ¥ ğŸ©ğŸ© ğŸ¥ğŸ¥ğŸ¥  ğŸªğŸª ğŸ¥ğŸ¥  â•‘
               â•‘  ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯ğŸ¯  â•‘
               â•‘  ğŸ¥ğŸ¥   ğŸªğŸª  ğŸ¥ğŸ¥ ğŸªğŸª  ğŸ¥ğŸ¥   ğŸªğŸª  â•‘
               â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
               â•‘â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â–‡â•‘
               â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
               â•‘  ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§  â•‘
               â•‘  ğŸ¥§    ğŸ“ğŸ“ğŸ“    ğŸ’ğŸ’    ğŸ‘ğŸ‘ğŸ‘    ğŸ¥§  â•‘
               â•‘  ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§ğŸ¥§  â•‘
               â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

`;


    console.log(cakeText);
    (() => { //ç»†èŠ‚ç®­å¤´å‡½æ•°å°è£…
      // ===== LeanCloud åˆå§‹åŒ– =====
      const APP_ID = "6pjrbSoLAkuqR8FEi18GRiv4-gzGzoHsz";
      const APP_KEY = "lwa2ISSpOdRZ15vYIQIlqG34";// è¿™äº›idå’Œkeyéƒ½å…¬å¼€äº†ï¼Œæ²¡è®°é”™çš„è¯æˆ‘çš„leanCloudçš„é‚£ä¸ªappçš„Classæƒé™è®¾çš„æ˜¯æ‰€æœ‰äººï¼Œå¦‚æœä½ æƒ³ç¯¡æ”¹ï¼Œæˆ‘ä¹Ÿä¸é˜»æ­¢ä½ å•¦ï¼ˆå…¶å®æ˜¯æˆ‘æ²¡æ‹›äº†ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰é•¿åŸé˜²ç«å¢™å•Šï¼ï¼ï¼ï¼‰
      const SERVER_URL = "https://6pjrbsol.lc-cn-n1-shared.com";
      AV.init({ appId: APP_ID, appKey: APP_KEY, serverURL: SERVER_URL });

      const MessageClass = AV.Object.extend('Message');

      // ===== DOM å…ƒç´  =====
      const msgsEl = document.getElementById('msgs');
      const sendBtn = document.getElementById('sendBtn');
      const refreshBtn = document.getElementById('refreshBtn');

      // ===== æç¤ºå‡½æ•° =====
      function showNotice(text, ok = true) {
        const n = document.createElement('div');
        n.textContent = text;
        n.style.padding = '8px';
        n.style.borderRadius = '8px';
        n.style.margin = '6px 0';
        n.style.fontSize = '13px';
        n.style.background = ok
          ? 'linear-gradient(90deg,#eafff8,#f1fff7)'
          : 'linear-gradient(90deg,#fff0f6,#ffeef6)';
        n.style.color = ok ? '#11664a' : '#8a2b4a';
        msgsEl.prepend(n);
        setTimeout(() => { n.style.opacity = '0.9'; }, 10);
      }

      // ===== ä¿å­˜åˆ° LeanCloud çš„å‡½æ•° =====
      async function sendDataToLC(uid, textArray, ip = null) {
        const msg = new MessageClass();
        msg.set('uid', uid);
        msg.set('text', JSON.stringify(textArray));
        msg.set('name', textArray[0]);
        msg.set('message', textArray[1]);
        msg.set('showOnBoard', !!textArray[2]);

        // ACLï¼šå…¬å¼€è¯»ã€ç¦æ­¢å…¬å¼€å†™
        const acl = new AV.ACL();
        acl.setPublicReadAccess(true);
        acl.setPublicWriteAccess(false);
        msg.setACL(acl);

        return msg.save();
      }

      // ===== LeanCloud: æ‹‰å–ç•™è¨€ =====
      async function fetchAllFromLC(showOnBoardOnly = true) {
        const query = new AV.Query('Message');
        if (showOnBoardOnly) query.equalTo('showOnBoard', true);
        query.descending('createdAt');
        query.limit(1000);

        const results = await query.find();
        const messages = results.map(obj => ({
          id: obj.get('uid') || obj.id,
          text: obj.get('text') || [
            obj.get('name') || '(åŒ¿å)',
            obj.get('message') || '',
            !!obj.get('showOnBoard')
          ],
          createdAt: obj.createdAt
        }));
        // console.log('Fetched messages:', messages);
        const totalQuery = new AV.Query('Message');
        const totalCount = await totalQuery.count();
        return { messages, totalCount };
      }

      // ===== æ¸²æŸ“ç•™è¨€ =====
      function renderMsgs(items) {
        msgsEl.innerHTML = '';
        if (!items || items.length === 0) {
          msgsEl.innerHTML = '<div class="msg">è¿˜æ²¡æœ‰ç•™è¨€ï¼Œåšç¬¬ä¸€ä¸ªç¥ç¦å§ï¼</div>';
          return;
        }
        items.slice(0, 40).forEach(it => {
          const d = document.createElement('div');
          d.className = 'msg';
          it.text = JSON.parse(it.text);
          // console.log('Rendering message:', it);
          d.innerHTML = `
        <strong>${escapeHtml(it.text[0] || 'å“ˆåŸºç±³')}</strong>
        <div style="margin-top:6px">${escapeHtml(it.text[1] || '')}</div>
        <small>${new Date(it.createdAt).toLocaleString()}</small>
      `;
          msgsEl.appendChild(d);
        });
      }

      function escapeHtml(s) {
        if (!s) return '';
        return s.replace(/[&<>"']/g, m => (
          { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]
        ));
      }

      // ===== å‘é€ç•™è¨€ï¼ˆæ•´åˆåŸé€»è¾‘ + è·å– IPï¼‰ =====
      async function sendData() {
        const uid = Date.now().toString();
        const showOnBoard = document.getElementById("showOnBoard").checked;
        let nameInput = (document.querySelector("#uid").value || 'å“ˆåŸºç±³').trim();
        if (nameInput === "") nameInput = "å“ˆåŸºç±³";
        let text = document.querySelector("#text").value;
        if (!text) { alert('è¯·å¡«å†™ä¸€æ®µç•™è¨€'); return; }
        if (text.length > 1000) alert('æˆ‘æ˜¯å½©è›‹ï¼šç•™è¨€è¿‡é•¿å¯èƒ½ä¼šè¢«æˆªæ–­å“¦~');
        const textArray = [nameInput, text, showOnBoard];
        sendBtn.disabled = true;
        sendBtn.textContent = 'å‘é€ä¸­...';
        // console.log('Sending message:', { uid, text: textArray });
        try {
          await sendDataToLC(uid, textArray);
          showNotice('å·²å‘é€ â€” æ„Ÿè°¢ä½ çš„ç¥ç¦ ğŸ‰', true);
          document.getElementById('text').value = '';
          await new Promise(r => setTimeout(r, 500));
          await fetchAndRender();
        } catch (e) {
          showNotice('å‘é€å¤±è´¥ï¼ˆLeanCloud é—®é¢˜ï¼‰', false);
          console.error(e);
        } finally {
          sendBtn.disabled = false;
          sendBtn.textContent = 'é€å‡ºç¥ç¦';
        }
      }

      // ===== æ‹‰å–å¹¶æ¸²æŸ“ï¼ˆæ•´åˆåŸé€»è¾‘ï¼‰ =====
      async function fetchAndRender() {
        try {
          const { messages, totalCount } = await fetchAllFromLC(true);
          // document.querySelector("small").textContent =
          //   `é€‰æ‹©æ˜¾ç¤ºç•™è¨€ä¼šæ˜¾ç¤ºåœ¨ä¸‹æ–¹ï¼ˆå«ä¸æ˜¾ç¤ºå…± ${totalCount} æ¡ï¼‰`;
          // æœ¬æ¥è¿™ä¸ªåŠŸèƒ½æ˜¯æˆ‘è‡ªå·±åŠ ä¸Šå»çš„ï¼Œä½†æ˜¯åæ¥è§‰å¾—æ²¡å¿…è¦å±•ç¤ºæ€»æ•°äº†ï¼Œæ¯•ç«Ÿæ€»æ•°å¯ä»¥å»ç é‡Œçœ‹ï¼ˆé€ƒ
          renderMsgs(messages);
        } catch (e) {
          showNotice('æ— æ³•è¯»å–ç•™è¨€ï¼ˆLeanCloud/ç½‘ç»œé—®é¢˜ï¼‰', false);
          console.error(e);
        }
      }

      // ===== æŒ‰é’®ç»‘å®š =====
      sendBtn.addEventListener('click', sendData);
      refreshBtn.addEventListener('click', fetchAndRender);

      // ===== é¡µé¢åˆæ¬¡åŠ è½½ =====
      fetchAndRender();

    })();
    // ===== åŸ Worker ç‰ˆæœ¬ï¼ˆå·²å¼ƒç”¨ï¼‰ =====è‡³äºä½ èƒ½çœ‹åˆ°è¿™å¨ä»£ç ï¼Œè¯´æ˜ä½ ä½ èƒ½çœ‹åˆ°è¿™å¨ä»£ç ã€‚ä½†æ˜¯å‘¢workerå’Œgithubåœ¨ä¸­å›½å¤§é™†æ²¡æœ‰vpnçš„é€Ÿåº¦ææ…¢ï¼Œç”šè‡³æ— æ³•è®¿é—®ï¼Œæ‰€ä»¥æˆ‘å°±å¼ƒç”¨äº†(çœ‹åˆ°è¿™å¥è¯çš„ä½ çŸ¥é“å½“æ—¶æå®Œå‘ç°å…³æ‰æ¢¯å­è¿ä¸åˆ°åç«¯æœ‰å¤šç»æœ›å—)ã€‚ï¼ˆå¯¹äº†ï¼Œå…¶å®è¿™äº›ä»£ç å‡ ä¹å…¨æ˜¯AIå†™çš„ï¼Œæˆ‘åªè´Ÿè´£éœ€æ±‚æ•´ç†ä¸éƒ¨åˆ†é‡å†™ï¼Œé”™è¯¯ä¿®æ”¹å’Œç›¸å¯¹ä¼˜åŒ–ï¼‰
    // (() => {
    //   const WORKER_URL = "https://soft-haze-72a6.boyangzhang246.workers.dev";
    //   const msgsEl = document.getElementById('msgs');
    //   const sendBtn = document.getElementById('sendBtn');
    //   const refreshBtn = document.getElementById('refreshBtn');

    //   function showNotice(text, ok = true) {
    //     const n = document.createElement('div');
    //     n.textContent = text;
    //     n.style.padding = '8px';
    //     n.style.borderRadius = '8px';
    //     n.style.margin = '6px 0';
    //     n.style.fontSize = '13px';
    //     n.style.background = ok ? 'linear-gradient(90deg,#eafff8,#f1fff7)' : 'linear-gradient(90deg,#fff0f6,#ffeef6)';
    //     n.style.color = ok ? '#11664a' : '#8a2b4a';
    //     msgsEl.prepend(n);
    //     setTimeout(() => { n.style.opacity = '0.9'; }, 10);
    //   }

    //   async function fetchAll(showOnBoardOnly = true) {
    //     try {
    //       const res = await fetch(`${WORKER_URL}?showOnBoard=${showOnBoardOnly}`, { method: 'GET' });
    //       // console.log('Fetched messages:', res);
    //       if (!res.ok) throw new Error('fetch error ' + res.status);
    //       const getData = await res.json();
    //       // console.log('Fetched messages:', getData);
    //       const totalCount = getData["totalCount"];
    //       data = getData["messages"];
    //       // console.log(data, totalCount);
    //       document.querySelector("small").textContent = `é€‰æ‹©æ˜¾ç¤ºç•™è¨€ä¼šæ˜¾ç¤ºåœ¨ä¸‹æ–¹ï¼ˆå«ä¸æ˜¾ç¤ºå…± ${totalCount} æ¡ï¼‰`;
    //       renderMsgs(data);
    //     } catch (e) {
    //       // console.warn(e);
    //       showNotice('æ— æ³•è¯»å–ç•™è¨€ï¼ˆWorker/ç½‘ç»œé—®é¢˜ï¼‰', false);
    //     }
    //   }


    //   function renderMsgs(items) {
    //     msgsEl.innerHTML = '';
    //     if (!items || items.length === 0) {
    //       msgsEl.innerHTML = '<div class="msg">è¿˜æ²¡æœ‰ç•™è¨€ï¼Œåšç¬¬ä¸€ä¸ªç¥ç¦å§ï¼</div>';
    //       return;
    //     }
    //     // æœ€è¿‘åœ¨ä¸Šæ–¹
    //     items.slice().reverse().slice(0, 40).forEach(it => {
    //       // if (it.text[2] === false) return;
    //       // console.log('Rendering message:', it);
    //       const d = document.createElement('div');
    //       d.className = 'msg';
    //       d.innerHTML = `<strong>${escapeHtml(it.text[0] || '(å“ˆåŸºç±³)')}</strong><div style="margin-top:6px">${escapeHtml(it.text[1] || '')}</div><small>${escapeHtml((new Date(parseInt(it.id))).toLocaleString() || '')}</small>`;
    //       msgsEl.appendChild(d);
    //     });
    //   }

    //   function escapeHtml(s) {
    //     if (!s) return '';
    //     return s.replace(/[&<>"']/g, (m) => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]));
    //   }

    //   async function sendData() {
    //     const uid = (new Date).getTime().toString();
    //     const showOnBoard = document.getElementById("showOnBoard").checked;
    //     let nameInput = document.querySelector("#uid").value || 'å“ˆåŸºç±³';
    //     nameInput = nameInput.trim();
    //     nameInput = nameInput === "" ? "å“ˆåŸºç±³" : nameInput;
    //     let text = document.querySelector("#text").value;
    //     if (!text) { alert('è¯·å¡«å†™ä¸€æ®µç•™è¨€'); return; }
    //     text = [nameInput, text, showOnBoard];

    //     sendBtn.disabled = true;
    //     sendBtn.textContent = 'å‘é€ä¸­...';

    //     try {
    //       const payload = { uid, text };
    //       // console.log('Sending payload:', JSON.stringify(payload));
    //       const res = await fetch(WORKER_URL, {
    //         method: 'POST',
    //         headers: { 'Content-Type': 'application/json' },
    //         body: JSON.stringify(payload)
    //       });
    //       if (!res.ok) throw new Error('æäº¤å¤±è´¥ ' + res.status);
    //       const j = await res.json();
    //       if (j && j.status === 'ok') {
    //         showNotice('å·²å‘é€ â€” æ„Ÿè°¢ä½ çš„ç¥ç¦ ğŸ‰', true);
    //         // æ¸…ç©º
    //         document.getElementById('text').value = '';
    //         // æ‹‰å–æœ€æ–°ç•™è¨€
    //         await new Promise(r => setTimeout(r, 800));
    //         await fetchAll();
    //       } else {
    //         showNotice('æœåŠ¡å™¨å“åº”å¼‚å¸¸', false);
    //       }
    //     } catch (err) {
    //       // console.error(err);
    //       showNotice('å‘é€å¤±è´¥ï¼ˆè¯·æ£€æŸ¥ç½‘ç»œæˆ– Workerï¼‰', false);
    //     } finally {
    //       sendBtn.disabled = false;
    //       sendBtn.textContent = 'é€å‡ºç¥ç¦';
    //     }
    //   }

    //   sendBtn.addEventListener('click', sendData);
    //   refreshBtn.addEventListener('click', fetchAll);

    //   // åˆæ¬¡åŠ è½½
    //   fetchAll();

    // })();
  </script>
</body>

</html>